<html xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xdt="http://www.w3.org/2005/xpath-datatypes" xmlns:fn="http://www.w3.org/2005/xpath-functions">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Sage Pay - Making Money Move</title>

	<style type="text/css" media="screen">
		
		* {
				margin: 0;
				padding: 0;
				}
		
		/* set page background colour */
		
		body {
				background: #FFFFFF;
				padding-bottom: 3.0em;
				}
		
		/* main document structure */
		
		#templateheader {
				background-image: url(images/sagepay/greybar_thin.gif);
				background-repeat: no-repeat;
				width: 670px;
				height: 30px;
				margin: 0 auto;
				top: 1.0em;
				padding-top: 0px;
				font: 1.0em Veranda, Arial, Helvetica;
				color: #FFFFFF;
				text-align: center
				}
				
		#templatelogos {
				background-image: url(images/sagepay/logo_background.jpg);
				background-repeat: repeat;
				width: 670px;
				margin: 0 auto;
				text-align: center;
				font: 0.8em Veranda, Arial, Helvetica;
				color: #000000;
				}
				
#sectionheader {
	padding: 25px 0px 12px 0px;
	font: 20px Verdana, Arial, Helvetica;
	color: #008469;
	text-align: center;
}		

				
		#templateamount {
				background-color: #FFFFFF;
				width: 670px;
				margin-top: 1.0em;
				margin-bottom: 1.0em;
				padding-left: 2.0em;
				font: 0.9em Veranda, Arial, Helvetica;
				text-align: left;
				list-style-position: outside;
				list-style-type: square;
				}				
								
		#templatefooter {
				width: 670px;
				height: 38px;
				padding-top: 5px;
				font: bold 1.1em Veranda, Arial, Helvetica;
				color: #FFFFFF;
				text-align: center;
				}
								
		/* Text */

		.errortext {
			color : #D80000;
			font: bold 0.9em Veranda, Arial, Helvetica;
				}
				
		.popheader {		
			color : #000000;
			font: bold 1.3em Veranda, Arial, Helvetica;
				}
				
		.questiontext {
			color : #cc3333;
			font: bold 1.0em Veranda, Arial, Helvetica;
				}
				
		.bodytext {
			color : #000000;
			font: 0.75em Veranda, Arial, Helvetica;
				}
		
		.bodytextbold {
			color : #000000;
			font: bold 0.8em Veranda, Arial, Helvetica;
				}
				
		.bodytextbolder {
			color : #000000;
			font: bold 1.0em Veranda, Arial, Helvetica;
				}
		
		.bodytextboldwhite {
			color : #FFFFFF;
			font: bold 0.8em Veranda, Arial, Helvetica;
				}
		
		.bodysmalltext {
			color : #000000;
			font: 0.7em Veranda, Arial, Helvetica;
				}
				
		.bodysmalltextbold {
			color : #000000;
			font: bold 0.7em Veranda, Arial, Helvetica;
				}
		
		.notetext {
			color : FF0000;
			font: bold 1.0em Veranda, Arial, Helvetica;
				}

		.highlight {
			color : #D80000;
			font: bold 0.9em Veranda, Arial, Helvetica;
				}
								
		.bodysmallblue {
			color : #005AA5;
			font: bold 0.7em Veranda, Arial, Helvetica;
				}

		.bodytextblue {
	color : #005AA5;
	font-family: Veranda, Arial, Helvetica;
	font-size: 1em;
	font-weight: normal;
				}
			
		/* Hyperlinks */
		
		#templatefooter a {
				font: 1.0em Veranda, Arial, Helvetica;
				color: #FFFFFF;
				text-decoration: none;
				}
		
		#templatefooter a:hover {
				font: 1.0em Veranda, Arial, Helvetica;
				color: #FFFFFF;
				text-decoration: underline
				}

	.style1 {color: #FF0000}

    </style>
</head>

<body>

	<div align="center" title="Sage Pay - Making Money Move">
	<div id="templateheader">
	</div>
	<div>
		<table border="0" cellpadding="5" cellspacing="0" width="670" align="center">
			<tr>
				<td align="left" ><img border="0" src="images/sagepay/sagepay_logo.gif"></td>
				<td align="left" width="400"></td>
				<td width="350" align="right"><br></td>
				<td align="left" width="25"></td>
			</tr>
		</table>
		<br>
	</div>
	<div id="sectionheader" style="background-image:url(images/YourImages/lines_5_orange.gif); background-repeat:no-repeat; background-position:center;">
		Custom Templates
	</div>
	<div id="sectionheader">Getting Started</div>
	<div id="templateamount">
	  <p>The Form and Server systems allow you to customise not only the look and feel of the payment pages presented to your customers, but also the design of the completion e-mails, error pages and 3D-secure frame pages.</p>
	  <p>&nbsp;</p>
	  <p>The templates are XSLT version 2 code, with no customised tags or non-standard additions. You can find a wealth of help on XSLT on the Internet and in numerous paper publications. Your web developers will be able to help you if you are unfamiliar with XSLT. If you do not have a Web Developer, Sage Pay have a number of partners in your area that will be able to help (please refer to our partners list at (<a href="http://www.sagepay.com/partners.html" target="_blank">http://www.sagepay.com/partners.html</a>) </p>
	  <p>&nbsp;</p>
	  <p>This kit not only provides the Sage Pay Default XSLT templates, the XML to populate them, and all images used on our pages, but also provides everything you need to render the XSLT templates into HTML pages during testing (using the freeware versions of Saxon (<a href="http://saxon.sourceforge.net/" target="_blank">http://saxon.sourceforge.net/</a>) and Kernow (<a href="http://sourceforge.net/projects/kernowforsaxon/" target="_blank">http://sourceforge.net/projects/kernowforsaxon/</a>)).</p>
	  <p>&nbsp;</p>
      <p>XML is provided for protocols 2.22 and 2.23 in directories XML_2.22 and XML_2.23 respectively. The default XML directory contains 2.23 versions. If you wish to use 2.22 simply copy all files from the XML_2.22 directory and paste into the XML directory.
      <p>&nbsp;</p>
      <p>All you need to use the renderers is the Java runtime version 1.4 or higher. The latest Java runtimes can be found at <a href="http://java.sun.com" target="_blank">http://java.sun.com/</a> </p>
	  <p>&nbsp;</p>
	  <p>Once you've installed the Java runtime, you're ready to go.</p>
	  <p>&nbsp;</p>
	  <p>&nbsp; </p>
	</div>
	<div id="sectionheader">Rendering a Template</div>
	<div id="templateamount">
	  <p>To render a template, follow these simple steps:</p>
	  <p>&nbsp; </p>
	  <ul>
	    <li>Double click the Kernow.bat batch file in the CustomTemplates folder (if you are using windows, otherwise copy the contents of that file onto your command line and execute them)</li>
        <li>Select the &quot;Single File&quot; tab.</li>
	    <li>Check the &quot;Send Output to File&quot; checkbox</li>
	    <li>Click the ... button next to the XML file edit box and browse to CustomTemplates/XML/card_confirmation.xml</li>
	    <li>Click the ... button next to the Stylesheet file edit box and browse to CustomTemplates/XSLT/card_confirmation.xslt</li>
	    <li>Click the ... button next to the OutputFile edit box and browse to CustomTemplates/HTML and create a new file called card_confirmation.html (NB: when creating the text e-mails, you'd set the file extension to .txt instead of .html) </li>
	    <li>Click Run.</li>
	    <li>A bar should appear whilst the system is working, then a message saying &quot;Done in xx milliseconds&quot; should appear. </li>
	    <li>Now open your web browser and browse directly to CustomTemplates/HTML/card_confirmation.html file. </li>
	    <li>This will display the order confirmation page. (NOTE: On some browsers you will need to click to allow Active Content to run if you wish to see the JavaScript mousovers etc. working)</li>
      </ul>
      <p>&nbsp;</p>
      <p>It's a simple as that. When you are changing the XSLT pages, any mistakes you make in the XSLT or XHTML code will be reported in the bottom window of the Kernow page when you click Run. The line number and position are displayed with each error, so it's very easy to debug your code.</p>
      <p>&nbsp; </p>
	</div>

	<div id="sectionheader">Editing the Templates </div>
	<div id="templateamount">
	  <p>The following templates are included in this kit:</p>
	  <p>&nbsp;</p>
	  <ul>
	    <li><strong>card_selection.xslt</strong> - This is the initial screen presented to your customers that asks them to click on an image to select the card type they wish to use. Render using card_selection.xml</li>
        <li><strong>card_details.xslt</strong> - The second payment page, which asks for the card number, expiry date, card holder name and so forth. It also has pop-up links to static HTML information pages in the images folder. Feel free to change these, or add other similar pop-ups that you think may help your customers. Render using card_details.xml</li>
        <li><strong>card_confirmation.xslt</strong> - The third payment page, which displays the full order summary (including basket contents where they have been passed) and a summary of the chosen card. Render using card_confirmation.xml</li>
	    <li><strong>card_authentication.xslt</strong> - The frame page surrounding the bank 3D-Secure pages which may be presented to your customers if you have enabled 3D-Secure on your account. This now has a &quot;skip3d&quot; button to allow users to continue even if 3D-Authentication fails. Render using card_authentication.xml</li>
	    <li><strong>authorisation.xslt</strong> - The &quot;Authorising please wait&quot; screen displayed for the few seconds that Sage Pay are talking to your acquiring bank to obtain an authorisation. Render using authorisation.xml</li>
        <li><strong>error.xslt</strong> - The error screen displayed by Server and Form if a problem has occurred with a transaction. Render using error.xml</li>
	    <li><strong>3d_callback.xslt, 3d_redirect.xslt</strong> - Simple forwarding pages which do not really need modification. They only display during the 3D-Secure process if a customer has JavaScript turned off. Their role is to post 3D-secure information from Sage Pay to the Issuing bank and back again. You may wish to change the text, but do not change the function or the 3D-Secure process will not work. Render using any xml file.</li>
	    <li><strong>post_through_browser.xslt</strong> - A very simple page that automatically redirects the browser to the 3D Secure ACSURL. Only visible if JavaScript is disabled in the browser. Shouldn't really need modification but can be rendered using any xml file and JavaScript turned off in your browser.</li>
        <li><strong><span class="style1">Form only: </span>form_response.xslt</strong> - The page displayed to Form customers if there are errors during transaction registration or completion. This provides a link back to your FailureURL page to prevent the customers being stranded on the Sage Pay site. Render using form_response.xml</li>
	    <li><strong><span class="style1">Form only:</span> customer_email.xslt, customer_email_text.xslt </strong> - The HTML and text e-mails (respectively) sent to your customer when a transaction completes successfully. Both should be rendered using customer_email.xml </li>
	    <li><strong><span class="style1">Form only:</span> vendor_email.xslt, vendor_email_text.xslt </strong> - The HTML and text e-mails (respectively) sent to your VendorEMail address whenever a transaction completes. Both should be rendered using vendor_email.xml.</li>
        <li><strong><span class="style1">Server only:</span> card_details_low.xslt</strong> - A low profile version of card_details.xslt which requests the same details apart from the card type. Render using card_details.xml  Please see note below on low profile templates for further information.<br/></li>
        <li><strong><span class="style1">Server only:</span> card_authentication_low.xslt</strong> - A low profile version of card_authentication.xslt. A very simple page that automatically redirects the browser to a full screen 3D-secure page. This page will only be visible if scripting is disabled within the browser. Can be rendered using any xml file and JavaScript disabled in your browser. Please see note below on low profile templates for further information.</li>
        <li><strong><span class="style1">Server only:</span> authorisation_low.xslt</strong> - A low profile version of authorisation.xslt. A basic full screen &quot;Authorising please wait&quot; page with a simple animated gif. Render using authorisation.xml. Please see note below on low profile templates for further information. </li>
      	<li><strong>i18n.xml</strong> - The templates are capable of supporting multiple languages however it is your responsibility to provide translations. The text displayed on the screen is sourced from the <strong>i18n.xml</strong> file included with the templates (except the e-mails). If you wish to create pages that support multiple languages, you should add additional text entries in this file. When you are satisfied your templates work in English, create a &lt;texts xml:lang=&quot;xx&quot;&gt; (where xx is the two character ISO 639 language, e.g. &quot;fr&quot; or &quot;de&quot;) with the same text labels, but their contents translated.</li>
        <li><strong>countries.xml</strong> - This file is used to create the Billing Country drop-down list on the Card Details page. This should not be amended.</li>
        <li><strong>states.xml</strong> - This file is used to create the Billing State drop-down on the Card Details page. A Billing State is only required if 'United States' has been selected in the Billing Country drop-down. This should not be amended.</li>
        
      </ul>
      
      
      <p>&nbsp;</p>
      <p>To edit the templates, simply open the XSLT file in your preferred editor and change the layout at your leisure. We use DreamWeaver at Sage Pay, but many XSLT editors are available on the net (including freeware editors). </p>
      <p>&nbsp;</p>
      <p><strong>Address Read-Only and No Address Templates</strong></p>
      <p>&nbsp;</p>
      <p>The default templates within this pack offer address fields which can be edited by the shopper while they are on the payment page. Should you wish to restrict this, you also have the option of setting the address to read-only or even show no address on the payment page at all.<br /><br /> 
      Card_Details.xslt and Card_Details_Low.xslt files are provided for read-only and no address payment pages within the XSLT_AddReadOnly and XSLT_NoAddress directories respectively. The default XSLT directory contains the default files with address fields which can be modified by the shopper. If you wish to use address read-only templates or templates with no address simply copy the relevant files from the XSLT_AddReadOnly or XSLT_NoAddress directory and paste into the XSLT directory. </p><br />
      <p><font color=red>Note:</font> Please ensure only one copy of the Card_Details.xslt and Card_Details_Low.xslt files are returned to the customer service team to ensure there is no confusion over which templates you wish to have uploaded.</p>
      <p>&nbsp;</p> 
      <p><strong>Low Profile Templates</strong></p>
      <p>&nbsp;</p>
      <p><span class="style1">Supported by Server protocol 2.23 only</span>. Low profile templates are designed to run inside I-frames and present full screen HTML pages with no pop-ups, no positional data and minimal graphics.<br/> To display these templates you need to pass a PROFILE=LOW name/value pair in your Server transaction registration. Please see 'Appendix A1:Transaction registration' of the 'Server Protocol and Integration Guidelines' document which can be downloaded from <a href="http://www.sagepay.com/help/downloads" target="_blank">http://www.sagepay.com/help/downloads</a> 
      <p>&nbsp;</p>
      <p><span class="style1">Please note</span>: Low profile templates are optional. You are not required to provide versions of these templates if you are not using low profile functionality.
      <p>&nbsp;</p>
      <p><strong>Images</strong><strong> and linked files </strong></p>
      <p>&nbsp;</p>
      <p>The images you can change are all included in the <span class="bodytextblue">CustomTemplates/images/YourImages</span> folder. Place any additional images or pop-ups in that folder, or subfolders thereof. Don't try to access images from anywhere else. Your templates will not work on our systems if you do so.</p>
      <p>&nbsp;</p>
      <p>You'll notice that all access to the images and documents in the YourImages folder is made using the XSLT variable called <span class="bodytextblue">$imageloc</span>. This is built dynamically at the top of each page and will contain the absolute path to your images when they are loaded onto our servers. <span class="style1">DO NOT use other references, such as &quot;../images&quot;. This code will not find your images when your templates are uploaded to our servers</span>. </p>
      <p>&nbsp;</p>
      <p>When you reference your new images from the your code, use the XSLT code <span class="bodytextblue">&lt;xsl:copy-of select=&quot;$imageloc&quot;/&gt;</span>, then your image name. So, for example, if you wanted to display an image called <em>cheese.gif</em> that you've placed in he YourImages folder,  you would use the code:</p>
      <p>&nbsp;</p>
      <p class="bodytextblue"> &lt;img&gt;<br>
        &lt;xsl:attribute name=&quot;src&quot;&gt;&lt;xsl:copy-of select=&quot;$imageloc&quot;/&gt;cheese.gif&lt;/xsl:attribute&gt;<br>
&lt;/img&gt;<br>
      </p>
      <p>If you wanted to support multiple languages, you would added &lt;text&gt; fields to the il8n.xml file to define the image location and <em>alt</em> tag, like this:</p>
      <p>&nbsp;</p>
      <p class="bodytextblue"> &lt;text label=&quot;<strong>cheese</strong>&quot;&gt;My favourite cheese &lt;/text&gt;<br>
&lt;text label=&quot;<strong>cheese_img_file</strong>&quot;&gt;cheese.gif&lt;/text&gt;</p>
      <p>&nbsp;</p>
      <p>Then create your image tag as follows:</p>
      <p>&nbsp;</p>
      <p> <span class="bodytextblue">&lt;img&gt;<br>
&lt;xsl:attribute name=&quot;src&quot;&gt;&lt;xsl:copy-of select=&quot;$imageloc&quot;/&gt;&lt;xsl:value-of select=&quot;$i18n/multi-lingual-text/texts[lang($lang)]/text[@label='<strong>cheese_img_file</strong>']&quot;/&gt;&lt;/xsl:attribute&gt;<br>
&lt;xsl:attribute name=&quot;alt&quot;&gt;&lt;xsl:value-of select=&quot;$i18n/multi-lingual-text/texts[lang($lang)]/text[@label='<strong>cheese</strong>']&quot;/&gt;&lt;/xsl:attribute&gt; <br>
&lt;/img&gt;<br> 
      </span></p>
      <p>&nbsp;</p>
      <p><strong>Your Logo</strong></p>
      <p>&nbsp;</p>
      <p>Your logo is referenced slightly differently from other images. When Sage Pay store your logo, it is held in a subfolder of our central images folder with the same name as your Vendor Name, called [VendorName].gif. So, for example, if your Vendor Name is <em>wonka</em>, your main logo will be at <span class="bodytextblue">https://[Sage Pay system URL]/images/wonka/wonka.gif</span></p>
      <p>&nbsp;</p>
      <p>This logo will be displayed in our default templates as well as your custom templates, so if you need to switch back to our templates, your customers will still know they are buying from you.</p>
      <p>&nbsp;</p>
      <p><img src="images/YourImages/YourImages.gif" alt="Your logo" width="208" height="96" align="left">In the custom template kit, this image (called YourImages.gif): represents the location  of your real logo (which you provide to Sage Pay when your account is set up). If you wish to replace this with your real logo whilst testing these pages, simply overwrite it, but leave your logo called YourImages.gif and leave the references to it in the style sheets as they are i.e.</p>
      <p>&nbsp; </p>
      <p>&nbsp;</p>
      <p class="bodytextblue"> &lt;img border=&quot;0&quot;&gt;<br>
&lt;xsl:attribute name=&quot;src&quot;&gt;&lt;xsl:value-of select=&quot;payment-model/imagesURL&quot;/&gt;&lt;xsl:value-of select=&quot;payment-model/vendor/vspvendorname&quot;/&gt;&lt;xsl:text disable-output-escaping=&quot;yes&quot;&gt;/&lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;payment-model/vendor/logo&quot;/&gt;&lt;/xsl:attribute&gt;<br>
&lt;/img&gt;<br>
      </p>
      <p>Bear in mind that your real logo will be called [VendorName].gif, so don't create any other images with that name.</p>
      <p>&nbsp;</p>
      <p>&nbsp; </p>
      <p><strong>Code and images you cannot change</strong> </p>
      <p>&nbsp;</p>
      <p>You'll notice that the Sage Pay logo and the JavaScript code is loaded from the <span class="bodytextblue">images/sagepay</span> folder. You cannot change this code or the images there (when your templates are uploaded, nothing from this folder will be uploaded to our servers) but you can use the JavaScript mouseover and pop-up functions in your code. </p>
      <p>&nbsp;</p>
      <p>The Customer Services team will validate your templates, but cannot offer to debug them for you. Please ask your web-developers for help if you are experiencing difficulties with XSLT or the multi-language support.</p>
      <p>&nbsp; </p>
	</div>
	<div id="sectionheader">Dos and Don'ts </div>
	<div id="templateamount">
	  <p>The templates are extremely flexible and allow you to completely customise the look and feel of the pages, but there are some rules you must follow: </p>
	  <p>&nbsp;</p>
	  <ul>
	    <li><strong>Do not change FORM field contents </strong> - If an edit box called &quot;CardNumber&quot; is rendered on a page inside a Form called &quot;Continue&quot;, then your page must also have an edit box called &quot;CardNumber&quot; inside a Form called &quot;Continue&quot;. You can change how that box displays, but not the fact that a box needs to be there. Also if a page contains three forms which submit different data, you should ensure your page behaves identically. </li>
		<li><strong>No additional JavaScript</strong> - Sage Pay only allow the pop-up and mouseover functions we've provided for you. No other JavaScript is allowed.</li>
	    <li><strong>Do not reference externally</strong> - We do not allow templates that reference code or images that are not on our server. All references should be to local documents placed in the YourImages folder. </li>
	    <li><strong>Do not navigate away from the payment pages</strong> - We do not allow links or redirects to pages before or after the payment pages. Once on the Sage Pay site, the customer must complete the payment process either by a successful transaction or by cancelling.</li>
	    <li><strong>Do not embed active content</strong> - ActiveX controls, streaming content, large movie files etc. will not be supported.</li>
	    <li><strong>Include the Sage Pay Logo in card_selection.xslt </strong> - Somewhere on your card-selection screen, you must include the Sage Pay logo. It is optional on subsequent screens.</li>
	    <li><strong>Do not modify the JavaScript files or logos in the images/sagepay folder</strong> - As mentioned above, these are provided for your reference and use, but will not be uploaded with your templates, so changing them will not help you.</li>
	    <li><strong>Do not modify the XML file</strong> - This are example files used for template creation. The real XML used by your templates on our test and live systems is generated dynamically. If you try to add fields to the XML and reference them, then these changes will not be transferred to live.</li>
        <li><strong>ALWAYS INCLUDE NOSCRIPT SECTIONS</strong> for every &lt;SCRIPT&gt; section in your templates. If you only use our mouseover functions to submit pages, for example, customers without JavaScript enabled will not be able to submit the pages and their payments will not be taken. You do not have to use JavaScript on your pages at all, if you do not wish to. </li>
	  </ul>
	  <p>&nbsp;</p>
	  <p>&nbsp;</p>
	</div>
	<div id="sectionheader">Getting your templates to Sage Pay</div>
	<div id="templateamount">
	  <p>When you are happy that your pages work correctly on your local machine (and have tested with JavaScript enabled AND disabled), zip up the contents of your XSLT and YourImages folders and e-mail them, along with your Vendor Name to <a href="mailto:templates@sagepay.com">templates@sagepay.com</a>.</p>
	  <p>&nbsp;</p>
	  <p>The  team there will validate them against the rules above, and if everything is okay, upload them to the test server for you. This process can take up to 72 hours. Once the team has come back to you, log into your Test My Sage Pay screens and set your templates to Custom in the Account Administration area, then test them.</p>
	  <p>&nbsp;</p>
	  <p>Unfortunately we cannot debug your XSLT code for you. Our team can only validate your templates against the rules above, not correct the XSLT itself (although we will validate that the XSLT is valid using the same tools we've provided to you). If you need help with XSLT, your web developer should be able to provide it. </p>
	  <p>&nbsp;</p>
	  <p>If you are happy with them on the test server, mail that address again and ask for your templates to be set live. The team will upload them for you and let you know when they are there. Again, you can set them live in your Live My Sage Pay.</p>
	  <p>&nbsp;</p>
	  <p>If you have questions about templates, please e-mail <a href="mailto:support@sagepay.com">support@sagepay.com</a> (include your Vendor Name) and we'll do our best to help you. </p>
	</div>

	<div id="templatefooter"></div>

</body>

</html>
